<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>RoR4_AP 3章 Scaffolding機能によるRails開発の基礎 | VagueLog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="3章を読み終えたので、要点をまとめていきます。3章ではscaffoldingという機能で、アプリケーションの雛形コードを生成して、Railsにおける基本的なCRUD(Create-Read-Update-Delete)機能を解説していくという内容でした。
なお、scaffolding機能は以下のような局面で役立つ模様。


まずは動作するアプリケーションを作成したい
マスターメンテナンスなど凝った">
<meta property="og:type" content="article">
<meta property="og:title" content="RoR4_AP 3章 Scaffolding機能によるRails開発の基礎">
<meta property="og:url" content="http://taka-p.github.io/2015/10/11/1/index.html">
<meta property="og:site_name" content="VagueLog">
<meta property="og:description" content="3章を読み終えたので、要点をまとめていきます。3章ではscaffoldingという機能で、アプリケーションの雛形コードを生成して、Railsにおける基本的なCRUD(Create-Read-Update-Delete)機能を解説していくという内容でした。
なお、scaffolding機能は以下のような局面で役立つ模様。


まずは動作するアプリケーションを作成したい
マスターメンテナンスなど凝った">
<meta property="og:image" content="http://taka-p.github.io/2015/10/11/1/IMG_0144.JPG">
<meta property="og:updated_time" content="2015-10-26T13:23:07.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RoR4_AP 3章 Scaffolding機能によるRails開発の基礎">
<meta name="twitter:description" content="3章を読み終えたので、要点をまとめていきます。3章ではscaffoldingという機能で、アプリケーションの雛形コードを生成して、Railsにおける基本的なCRUD(Create-Read-Update-Delete)機能を解説していくという内容でした。
なお、scaffolding機能は以下のような局面で役立つ模様。


まずは動作するアプリケーションを作成したい
マスターメンテナンスなど凝った">
  
    <link rel="alternative" href="/atom.xml" title="VagueLog" type="application/atom+xml">
  
  
    <link rel="icon" href="/ta.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/tokyo_gool.jpg" class="js-avatar">
			
		</a>

		<hgroup>
			<h1 class="header-author"><a href="/">VagueLog</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>

				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>TagCloud</li>
						
						
						<li>About me</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">ホーム</a></li>
						
							<li><a href="/archives">過去記事一覧</a></li>
						
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/taka-p" title="github">github</a>
							
						</div>
					</nav>
				</section>

 				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Ruby/" style="font-size: 20px;">Ruby</a> <a href="/tags/Ruby-on-rails/" style="font-size: 20px;">Ruby on rails</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/test/" style="font-size: 10px;">test</a> <a href="/tags/目標/" style="font-size: 10px;">目標</a>
					</div>
				</section>
				

				

				
					
					<section class="switch-part switch-part3">
					
						<div id="js-aboutme">普段はフロントエンド周りに触れています。<br>
週末はRailsを頑張っています。<br>
プールで泳ぐの好きです。<br>
お勉強友達がホスｲ..<br>
_:(´ཀ`」 ∠):_</div>
					</section>
				
			</div>
		</div>
	</header>
	
		<div id="js_toc_left" class="toc-left-area">
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#コールバック"><span class="toc-text">コールバック</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#利用可能なコールバックと実行タイミング"><span class="toc-text">利用可能なコールバックと実行タイミング</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#コールバック実装の基本"><span class="toc-text">コールバック実装の基本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#コールバックの様々な定義方法"><span class="toc-text">コールバックの様々な定義方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ブロック形式で定義する"><span class="toc-text">ブロック形式で定義する</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#コールバッククラスとして定義する"><span class="toc-text">コールバッククラスとして定義する</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#マイグレーション"><span class="toc-text">マイグレーション</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#マイグレーションのしくみ"><span class="toc-text">マイグレーションのしくみ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#マイグレーションファイルの構造"><span class="toc-text">マイグレーションファイルの構造</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#引数toptionテーブルオプション"><span class="toc-text">引数toptionテーブルオプション</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#フィールド定義は「t-データ型」で行う"><span class="toc-text">フィールド定義は「t.データ型」で行う</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#列フラグも定義できる（制約の追加）"><span class="toc-text">列フラグも定義できる（制約の追加）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#マイグレーションファイルの作成"><span class="toc-text">マイグレーションファイルの作成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#マイグレーションファイルで利用できる主なメソッド"><span class="toc-text">マイグレーションファイルで利用できる主なメソッド</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#テーブル定義を変更するchange_tableメソッド"><span class="toc-text">テーブル定義を変更するchange_tableメソッド</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#インデックスの追加と削除add_index、remove_indexメソッド"><span class="toc-text">インデックスの追加と削除add_index、remove_indexメソッド</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#任意のSQL命令を実行するexcuteメソッド"><span class="toc-text">任意のSQL命令を実行するexcuteメソッド</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HABTM中間テーブルを生成するcreate_join_tableメソッド"><span class="toc-text">HABTM中間テーブルを生成するcreate_join_tableメソッド</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#マイグレーションファイルの実行"><span class="toc-text">マイグレーションファイルの実行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#リバーシブルなマイグレーションファイル"><span class="toc-text">リバーシブルなマイグレーションファイル</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ロールバックのための情報を追加するremove_column、drop_tableメソッド"><span class="toc-text">ロールバックのための情報を追加するremove_column、drop_tableメソッド</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#バージョンアップ、ダウンの処理を分岐するreversibleメソッド"><span class="toc-text">バージョンアップ、ダウンの処理を分岐するreversibleメソッド</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#バージョンアップ、ダウンの処理を分岐するup、downメソッド"><span class="toc-text">バージョンアップ、ダウンの処理を分岐するup、downメソッド</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#データの初期化"><span class="toc-text">データの初期化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#シードファイル"><span class="toc-text">シードファイル</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#フィクスチャ"><span class="toc-text">フィクスチャ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#フィクスチャで大量のデータを生成する"><span class="toc-text">フィクスチャで大量のデータを生成する</span></a></li></ol></li></ol></li></ol></li></ol>
		</div>
	
	
		<div id="js_back_to_top" class="back-to-top"></div>
	
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">VagueLog</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/tokyo_gool.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">VagueLog</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">ホーム</a></li>
		        
					<li><a href="/archives">過去記事一覧</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/taka-p" title="github">github</a>
			        
				</div>
			</nav>
		</header>
	</div>
</nav>
      <div class="body-wrap"><article id="post-RubyonRails4アプリケーションプログラミング-3章" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      RoR4_AP 3章 Scaffolding機能によるRails開発の基礎
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ruby/">Ruby</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ruby-on-rails/">Ruby on rails</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
        
          <div class="article-meta">
            <a href="/2015/10/11/1/" class="article-date">
  	<time datetime="2015-10-11T02:11:00.000Z" itemprop="datePublished">2015-10-11</time>
</a>
          </div>
        
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>3章を読み終えたので、要点をまとめていきます。<br>3章ではscaffoldingという機能で、アプリケーションの雛形コードを生成して、Railsにおける基本的なCRUD(Create-Read-Update-Delete)機能を解説していくという内容でした。</p>
<p>なお、scaffolding機能は以下のような局面で役立つ模様。</p>
<blockquote>
<ul>
<li>まずは動作するアプリケーションを作成したい</li>
<li>マスターメンテナンスなど凝ったレイアウトを要求されないページを大量に作成したい</li>
<li>Railsによる基本的なCRUD実装を理解したい</li>
</ul>
</blockquote>
<a id="more"></a>
<p>プロトタイプの作成、社内業務システム系や管理画面、railsの練習などに向いた機能という事でしょう。</p>

<br>

<h2 id="雛形作成のコマンド_-_scaffold">雛形作成のコマンド - scaffold</h2><p>以下、scaffolding機能を実行するコマンド。<br>Model,View,Controllerを一括で生成してくれる<br><figure class="highlight"><figcaption><span>ターミナル</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g scaffold name field:type [...] [options]</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>name: モデル名、field: フィールド名、type: データ型、option: 動作オプション</p>
</blockquote>
<p><code>model</code>が<code>scaffold</code>に変わっただけで、ほとんどモデルと同じ構文。</p>

<br><br>

<h2 id="ルーティングの確認">ルーティングの確認</h2><ul>
<li><strong>resourcesメソッド</strong><br>scaffolding機能によってアプリケーションを生成すると、<code>config/routes.rb</code>に以下の記述が追加される。<figure class="highlight"><figcaption><span>routes.rb</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resources :books</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>上記の<code>resources</code>メソッドによって、booksリソースに対する標準的なCRUD操作がまとめて提供される。</p>
<table>
<thead>
<tr>
<th>URL</th>
<th>アクション</th>
<th>HTTPメソッド</th>
<th>役割</th>
</tr>
</thead>
<tbody>
<tr>
<td>/books(.:format)</td>
<td>index</td>
<td>GET</td>
<td>一覧画面を表示</td>
</tr>
<tr>
<td>/books/:id(.:format)</td>
<td>show</td>
<td>GET</td>
<td>個別詳細画面を表示</td>
</tr>
<tr>
<td>/books/new(.:format)</td>
<td>new</td>
<td>GET</td>
<td>新規登録画面を表示</td>
</tr>
<tr>
<td>/books(.:format)</td>
<td>create</td>
<td>POST</td>
<td>新規登録画面の入力を受けて登録処理</td>
</tr>
<tr>
<td>/books/:id/edit(.:format)</td>
<td>edit</td>
<td>GET</td>
<td>編集画面を表示</td>
</tr>
<tr>
<td>/books/:id(.:format)</td>
<td>update</td>
<td>PATCH / PUT</td>
<td>編集画面の入力を受けて更新処理</td>
</tr>
<tr>
<td>/books/:id(.:format)</td>
<td>destroy</td>
<td>DELETE</td>
<td>一覧画面で指定されたデータの削除処理</td>
</tr>
</tbody>
</table>
<blockquote>
<p>備考として、<code>()</code>は省略可能、<code>.:format</code>はデータを描画するテンプレートを指定する構文で、省略した場合は<code>.html.erb</code>が選択される<br>その他、jsonをパースする<code>.json.jbuilder</code>などが指定できる<br><code>ex. http://localhost:3000/books.json</code><br>上記は、<strong>erbを利用してhtml形式の出力を生成するためのテンプレート</strong>、<strong>jbuilderを利用してjson形式の出力を生成するためのテンプレート</strong>という意味を持つ</p>
</blockquote>

<br>

<ul>
<li><strong>ルーティングの状態を確認する方法</strong><br>以下2つがある。</li>
</ul>
<ol>
<li>ターミナルから<code>rake routes</code>を叩く</li>
<li>ブラウザから<code>http://localhost:3000/rails/info/routes</code>にアクセスする</li>
</ol>

<br><br>

<h2 id="View関連のメソッド（ビューヘルパー）">View関連のメソッド（ビューヘルパー）</h2><ul>
<li><strong>link toメソッド</strong><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">link_to</span><span class="params">(body, url [,html_options])</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>body: リンクテキスト、url: リンク先のパス、html_options: [属性名: 値]のハッシュ形式</p>
</blockquote>
<p>ルート定義に記載される<code>*_path</code>というヘルパーをurlに指定するのが一般的。<br>urlにモデルオブジェクトが渡された場合は、book.idを取得して<code>books/1</code>のようなパスが生成される。<br>また、以下のように<code>data-confrm</code>オプションを指定する事で「リンククリック時に確認ダイアログを表示する」という振る舞いを行う。<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= link_to <span class="string">'不可逆的な操作'</span>, url, <span class="string">data:</span> &#123; <span class="string">confirm:</span> <span class="string">'Are you sure?'</span> &#125; %&gt;</span><br></pre></td></tr></table></figure></p>
<p>なお、HTTP GET以外のメソッドにハイパーリンク経由でアクセスする場合は、明示的に<code>method: delete</code>のような記述を行う必要がある。<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= link_to <span class="string">'Destroy'</span>, url, <span class="function"><span class="keyword">method</span>:</span> delete, data: <span class="comment">&#123; confirm: 'Are you sure?' &#125;</span> %&gt;</span><br></pre></td></tr></table></figure></p>

<br>

<ul>
<li><strong>renderメソッド（Controllerでも使う）</strong><br>テンプレート内に下記の記述を行う事で、<strong>部分テンプレート</strong>である<code>_form.html.erb</code>が呼び出される。<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="variable">%=</span> <span class="keyword">render</span> <span class="string">'form'</span> <span class="variable">%&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>なお、部分テンプレートはファイル名の接頭辞に<code>_</code>を付けること。</p>

<br>

<ul>
<li><strong>form_forメソッド</strong><br>モデルオブジェクトに関連づけたフォームを生成するメソッド。<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">form_f<span class="subst">or</span>(model) <span class="keyword">do</span> |f|</span><br><span class="line">  <span class="attribute">...</span>フォームの本体<span class="attribute">...</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>model: モデルオブジェクト</p>
</blockquote>
<p>モデルオブジェクトとの関連付けを行う事によって、<strong>入力値をモデルのプロパティに割り当てる</strong>、<strong>編集・エラー時にモデルの現在値をフォームに書き戻す</strong>というメリットを享受できる。<br>また、この際に渡されるモデルオブジェクトが空であるか否かによって（正確にはレコードが新規か既存かによって）、action属性の内容を変化させ、新規レコードの場合はcreateアクション、既存レコードの場合はupdateアクションへのURLを生成する。</p>
<p>なお、モデルに関連づけたくない場合は<code>form_tag</code>メソッドを利用する。</p>

<br><br>

<h2 id="Controller関連のメソッド">Controller関連のメソッド</h2><ul>
<li><strong>before_actionメソッド</strong><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">before_action <span class="function"><span class="keyword">method</span>, <span class="title">only</span>:</span> action</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>method: フィルタとして実行されるメソッド<br>action: フィルタを適用するアクション（配列）</p>
</blockquote>
<p>コントローラファイルに定義される、アクションメソッド群の前に実行したいメソッドを指定する構文。（このようなメソッドを<code>フィルタ</code>と呼ぶ）<br>以下は、<code>set_book</code>というフィルタをshowアクションに適用した例。<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">before_action <span class="symbol">:set_book</span>, <span class="symbol">only:</span> [<span class="symbol">:show</span>]</span><br><span class="line">略...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span></span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">略...</span><br><span class="line"><span class="keyword">private</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">set_book</span></span></span><br><span class="line">    <span class="variable">@book</span> = <span class="constant">Book</span>.find(params[<span class="symbol">:id</span>])</span><br><span class="line">  <span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>なお、意図しないアクションとして呼び出されないために、private宣言を行っている。</p>

<br>

<ul>
<li><strong>StrongParameters</strong><br>CreateアクションやUpdateアクションにおいて、Viewからポストデータを取得する際、取得できるパラメータを制限する処理。（セキュリティ強化のため）<figure class="highlight ruby"><figcaption><span>books_controller.rb</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...略</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span></span></span><br><span class="line">  <span class="variable">@book</span> <span class="constant">Book</span>.new(book_params)</span><br><span class="line">...略</span><br><span class="line"></span><br><span class="line">private</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">book_params</span></span></span><br><span class="line">    params.<span class="keyword">require</span>(<span class="symbol">:book</span>).permit(<span class="symbol">:isbn</span>, <span class="symbol">:title</span>, <span class="symbol">:price</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>なお、rails4から導入された機能のため、rails3以前のscaffoldで生成されたアプリケーションではエラーが発生する。</p>

<br>

<ul>
<li><strong>respond_toメソッド</strong><br>クライアントからリクエストされたURLの<code>.:format</code>によって、行う処理を分岐できるメソッド。<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">respond_to <span class="keyword">do</span> |format|</span><br><span class="line">  format.html &#123; テンプレートの渡す処理 &#125;</span><br><span class="line">  format.json  &#123; テンプレートの渡す処理 &#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>なお、rails4からは指定しない場合は、デフォルトのテンプレートを呼び出す振る舞いを行う。</p>

<br>

<ul>
<li><strong>redirect_toメソッド</strong></li>
</ul>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redirect_to url <span class="string">[,option]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>url: リダイレクト先のパス、option: オプション</p>
</blockquote>
<p>良く利用するオプションとして、リダイレクト先にメッセージを伝える<code>notice</code>がある。<br>他、応答時に使用するHTTPステータスを指定する<code>status</code>など。</p>

<br>

<ul>
<li><strong>saveメソッド</strong><br>データベース操作の結果を<code>true/false</code>で返す<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="variable">@book</span>.save</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>

<br>

<ul>
<li><strong>updateメソッド</strong><br>更新の正否を<code>true/false</code>で返す<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">update</span><span class="params">(attrs)</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>attrs: 更新データ[プロパティ名: 値]のハッシュ形式<br><code>ex. if @book.update(book_params)</code></p>
</blockquote>

<br>

<ul>
<li><strong>headメソッド</strong><br>HTTPステータス（処理結果）のみを通知し、コンテンツ本体は出力しないメソッド<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head <span class="keyword">status</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>status: 応答ステータス<br><code>ex. format.json { head :no_content }</code></p>
</blockquote>

<br><br>

<h2 id="その他補足">その他補足</h2><ul>
<li><strong>RESTfulインターフェースの擬似的な実現</strong><br><code>link_to</code>メソッドや<code>form_for</code>メソッドにより描画されるhtmlに、HTTPメソッドの情報が付与される理由は、「ブラウザはすべてのHTTPメソッドに対応しているべきで、目的に応じて、それぞれを使い分けるべき」というRESTfulな思想を緊急避難的に体現するため。<br>（一般的なブラウザはHTTP DELETE,PUT,PATCHメソッドに対応していない）<br>link_toメソッドでは<code>data-method</code>属性に、form_forメソッドではinputの<code>name</code>属性にHTTPメソッドの情報が付与される。</li>
</ul>

<br>

<ul>
<li><strong>PATCH / PUTの違い</strong><br>rails3では更新処理にPUTが採用されていたが、rails4ではPATCHに振り替られた。<br>PUTは本来「リソースの完全な置換」という性質を持つが、更新処理を行うリソースは大抵の場合、部分的な更新を行う事が多く、「リソースの部分的な更新」という性質を持つPATCHが採用された。<br>rails4において、PATCH / PUTの両方が存在するのは、後方互換性に配慮されているためである。</li>
</ul>

<br><br>

<p>以上で3章は終わりです。<br>次回は、細かい内容まで言及している4章を書いていきます。</p>

<br>

<p>PS. 他のやつ届いた<br>思いのほか汚い_:(´ཀ`」 ∠):_<br>あと、真ん中のやつがrails4対応かと思ったら、赤い電車のとこに「Rails3」て書いてた凡ミス..w</p>
<p><img src="/2015/10/11/1/IMG_0144.JPG" alt="amazonで買ったrails本たち" title="amazonで買ったrails本たち"></p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/10/17/1/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          RoR4_AP 4章 ビュー開発① - フォーム関連のビューヘルパー
        
      </div>
    </a>
  
  
    <a href="/2015/10/06/4/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">RoR4_AP 1-2章 イントロダクション・Railsの基本</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>





</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 taka-p
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>